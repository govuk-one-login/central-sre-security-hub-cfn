name: Experiments

on:
  push:
    branches:
      - f/SW-217
  workflow_dispatch:

permissions:
  id-token: write
  contents: read
jobs:
  experiment:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Has the Service Catalog Template changed
        id: changed-files
        uses: tj-actions/changed-files@v42
        with:
          files: |
            service_catalog_portfolios/**
         
      - name: Identify the files that have changed
        if: steps.changed-files.outputs.any_changed == 'true'
        env:
          ALL_CHANGED_FILES: ${{ steps.changed-files.outputs.all_changed_files }}
        run: |
          for file in ${ALL_CHANGED_FILES}; do
            COMMAND=$(echo "$file" | awk -F/ '{print "cat "$1 "/" $2 "/" $3 "/taskcat.txt >> .taskcat_alt.yml"}')
            echo $COMMAND >> taskcat_command_builder.txt
          done
          sort taskcat_command_builder.txt | uniq > taskcat_command_builder.sh
          chmod +x taskcat_command_builder.sh
          ./taskcat_command_builder.sh
          cat .taskcat_alt.yml